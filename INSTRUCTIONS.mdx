# Test de la couche validation (Zod)

### 💡 Lancer des tests validation

## 📝 Tes notes

Détaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template).

## Comprendre

Dans cette section, tu vas tester les schémas de validation de ton application avec **`Zod`**. Les schémas de validation garantissent que les données envoyées à ton service respectent les formats et contraintes attendus. Ces tests sont essentiels pour sécuriser et fiabiliser la couche de validation de ton application.

L’objectif de cet exercice est de valider trois schémas principaux :

1. **`deleteProductServiceSchema`** : Validation des données pour la suppression d’un produit.
2. **`createEditProductServiceSchema`** : Validation des données pour la création ou la modification d’un produit.
3. **`updateProductServiceShema`** : Validation des données pour la mise à jour d’un produit.

Tu commenceras par tester les cas de base, comme des champs requis ou invalides, puis tu ajouteras des cas avancés dans les bonus.

Voici un exemple de schéma `Zod` simple pour valider un objet produit :

```jsx
import {z} from 'zod'

const productSchema = z.object({
  id: z.string().uuid(),
  title: z.string().min(2, 'Title must be at least 2 characters.'),
  description: z.string().min(2, 'Description must be at least 2 characters.'),
  price: z.number(),
})
```

Le schéma ci-dessus définit les contraintes suivantes :

- `id` doit être une chaîne au format `UUID`.
- `title` doit être une chaîne avec au moins 2 caractères.
- `description` doit également avoir au moins 2 caractères.
- `price` doit être un nombre.

📑 Le lien vers la doc [Zod Documentation](https://zod.dev/).

## Exercice

Dans cet exercice, tu utiliseras **`Vitest`** pour écrire des tests et vérifier que ces schémas se comportent correctement.

### Tests à réaliser :

1. **`deleteProductServiceSchema`** :
   - Valide un objet avec un `id` UUID.
   - Rejette un objet si l'`id` est invalide (par exemple, un nombre à la place d’une chaîne).
2. **`createEditProductServiceSchema`** :
   - Valide un produit avec les champs requis (`category`, `price`, `title`, `description`).
   - Rejette un produit si :
     - Le titre est trop court (moins de 2 caractères).
     - La description est trop courte (moins de 2 caractères).
     - Des champs requis comme `category`, `title`, ou `description` sont manquants.

Fichiers

- `src/services/__tests__/product-validation.test.ts`

## Bonus

### 1. 🚀 Tester les champs optionnels dans `createEditProductServiceSchema`

Ajoute des tests pour valider que :

1. Les champs optionnels comme `id`, `createdAt`, et `quantity` sont acceptés.
2. Les champs numériques passés en chaîne (`"299.99"`) sont convertis en nombres.

Fichiers

- `src/services/__tests__/product-validation.test.ts`

### 2. 🚀 Valider la mise à jour avec `updateProductServiceShema`

Ajoute des tests pour valider que :

1. Les données sont acceptées avec un `id` valide et des champs optionnels (`createdAt`, `quantity`).
2. Les données sont rejetées si :
   - L'`id` est manquant.
   - L'`id` est invalide (par exemple, un nombre au lieu d'une chaîne `UUID`).

Fichiers

- `src/services/__tests__/product-validation.test.ts`

## Aller plus loin

📑 Le lien vers la doc [Zod Documentation](https://zod.dev/).

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand tu devras simplifier ton schéma ou ton code._
- **👨‍✈️ Hugo le chef de projet** : _Hugo t’aidera sur les spécifications des schémas._

## 🐜 Feedback

Remplis [le formulaire de feedback](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=8.Test%20Service%20Validation&entry.533578441=04%20test%20couche%20Validation).
