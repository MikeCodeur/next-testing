# Test Service : Autorisation

### 💡 Description longue de l'exercice

Dans cette section, tu vas écrire des tests pour valider les fonctions d’autorisation de ton application. Ces fonctions permettent de vérifier les permissions, les rôles et la hiérarchie des rôles utilisateurs.

L’objectif est de :

1. Garantir que seuls les utilisateurs autorisés peuvent effectuer certaines actions.
2. Tester les différents cas possibles, même ceux inattendus, pour garantir une application robuste.

Tu commenceras par tester deux fonctions principales : `canCreateProduct` et `canReadProduct`, avant d’ajouter des tests pour les rôles et la hiérarchie dans les bonus.

## 📝 Tes notes

Détaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template).

## Comprendre

Voici un exemple de fonction pour générer un utilisateur de test :

```jsx
const createTestUser = (role: RoleEnum): AuthUser => ({
  role,
  user: {
    id: faker.string.uuid(),
    email: faker.internet.email(),
    name: faker.person.firstName(),
    image: null,
  },
  session: {
    expires: new Date().toDateString(),
    user: {
      email: faker.internet.email(),
      name: faker.person.firstName(),
    },
  },
});

```

📑 Le lien vers la doc officielle [Vitest Documentation](https://vitest.dev/).

Les tests te permettront de vérifier que les fonctions retournent les bons résultats en fonction des rôles des utilisateurs.

---

## Exercice principal

Dans cet exercice, tu vas tester les deux fonctions suivantes :

1. **`canCreateProduct`** : Vérifie si un utilisateur peut créer un produit.
2. **`canReadProduct`** : Retourne toujours `true`, peu importe l’utilisateur.

Il est important de comprendre comment tester ces cas pour s'assurer que les autorisations de base sont bien respectées.

### Fichiers

- `exercise/service-authorization.test.js`

---

## Bonus

### 1. 🚀 Tester les rôles (`hasRoleAdmin` et `hasRole`)

Ajoute des tests pour valider les rôles des utilisateurs :

1. **`hasRoleAdmin`** :
   - Vérifie qu’un utilisateur admin est correctement identifié.
   - Vérifie qu’un utilisateur non admin est refusé.
2. **`hasRole`** :
   - Vérifie qu’un utilisateur possède un rôle donné.
   - Vérifie que la fonction retourne `false` si le rôle ne correspond pas.

### Fichiers

- `bonus-1/service-authorization.test.js`

---

### 2. 🚀 Vérifier la hiérarchie des rôles (`checkRoleHierarchy`)

Ajoute des tests pour valider la hiérarchie des rôles :

1. Un utilisateur avec un rôle supérieur peut accéder aux fonctionnalités des rôles inférieurs.
2. Un utilisateur avec un rôle égal peut accéder à ses propres fonctionnalités.
3. Un utilisateur avec un rôle inférieur ne peut pas accéder aux fonctionnalités des rôles supérieurs.

### Fichiers

- `bonus-2/service-authorization.test.js`

---

## Aller plus loin

📑 Le lien vers la documentation :

- [Vitest](https://vitest.dev/)
- [Faker.js](https://fakerjs.dev/)

---

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à simplifier ou à supprimer est présent._
- **👨‍✈️ Hugo le chef de projet** : _Hugo t’aidera sur les spécifications des tests._

---

## 🐜 Feedback

Remplis le formulaire de [FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=8.Next%20Testing&entry.533578441=03%20Test-authorization).
