# Test de la couche service (avec DAO mockÃ©)

### ğŸ’¡ Description longue de l'exercice

Dans cette section, tu vas tester les fonctions de service utilisÃ©es pour gÃ©rer les produits. Ces services interagissent avec la couche DAO (Data Access Object) pour effectuer les opÃ©rations sur les donnÃ©es. L'objectif est de s'assurer que chaque service fonctionne correctement et respecte les rÃ¨gles d'autorisation dÃ©finies.

Tu utiliseras **Vitest** pour Ã©crire et exÃ©cuter les tests, et tu apprendras Ã  :

1. Mocker la couche DAO pour simuler des appels Ã  la base de donnÃ©es.
2. Tester les autorisations en fonction des rÃ´les utilisateur.
3. Valider les comportements pour diffÃ©rents scÃ©narios (succÃ¨s, Ã©chec, permissions).

---

## ğŸ“ Tes notes

DÃ©taille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template).

---

## Comprendre

Voici un exemple de mock simple en Vitestâ€¯:

```jsx
javascript
CopierModifier
vi.mock('@/db/repositories/product-repository', () => ({
  getProductsDao: vi.fn(),
}))

vi.mocked(productRepository).getProductsDao.mockResolvedValue([
  {
    id: '12345',
    title: 'Produit test',
  },
])
```

ğŸ“‘ Le lien vers la doc officielle de Vitest Mocking.

---

## Exercice

Dans cet exercice, tu dois tester les services suivantsâ€¯:

### 1. **`getProductsService`** (Lecture des produits)

- Mocke le DAO `getProductsDao` pour simuler une liste de produits.
- VÃ©rifie que tout le monde (tous les rÃ´les) peut appeler ce service.

### 2. **`getCategoriesService`** (Lecture des catÃ©gories)

- Mocke le DAO `getCategoriesDao` pour simuler une liste de catÃ©gories.
- VÃ©rifie que tout le monde (tous les rÃ´les) peut appeler ce service.

**Fichiers Ã  utiliser :**

- `exercise/services/product-service-mocked.exercise.js`

---

## Bonus

### 1. ğŸš€ **`createProductService`**

Ajoute des tests pour la crÃ©ation de produit :

- VÃ©rifie qu'un utilisateur avec le rÃ´le `USER` ne peut pas crÃ©er de produit.
- VÃ©rifie qu'un utilisateur avec le rÃ´le `ADMIN` peut crÃ©er un produit.
- Mocke le DAO `createProductDao` pour valider son appel avec les bons arguments.

**Fichiers Ã  utiliser :**

- `exercise/services/product-service-mocked.bonus-1.js`

---

### 2. ğŸš€ **`updateProductService`**

Ajoute des tests pour la mise Ã  jour de produit :

- VÃ©rifie qu'un utilisateur avec le rÃ´le `USER` ne peut pas mettre Ã  jour un produit.
- VÃ©rifie qu'un utilisateur avec le rÃ´le `ADMIN` peut mettre Ã  jour un produit.
- Mocke le DAO `updateProductDao` pour valider son appel avec les bons arguments.

**Fichiers Ã  utiliser :**

- `exercise/services/product-service-mocked.bonus-2.js`

---

## Aller plus loin

ğŸ“‘ Le lien vers la doc pour Mocker les modules en JavaScript.

---

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia la Roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent._
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va tâ€™aider sur les spÃ©cifications du projet._

---

## ğŸœ Feedback

Remplis le [formulaire de FeedBack](https://go.mikecodeur.com/cours-react-avis).
