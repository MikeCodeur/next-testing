# Configurer Vitest + Next

### 💡 Comprendre la config de Vitest

## 📝 Tes notes

Détaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Nous allons utiliser `Vitest` comme utilitaire de test [https://vitest.dev/](https://vitest.dev/)

`Vitest` est un framework de test rapide et intégré à `Vite`, idéal pour les projets `React` modernes.

### Dépendances

```tsx
 "@faker-js/faker": "^9.0.3",
 "@testing-library/cypress": "^10.0.2",
 "@testing-library/jest-dom": "6.4.8",
 "@testing-library/react": "^16.0.1",
 "@vitejs/plugin-react": "^4.3.1",
 "@vitest/eslint-plugin": "^1.1.7",
 "jsdom": "^24.1.1",
 "vite-tsconfig-paths": "^4.3.2",
 "vitest": "^2.0.4"

 //script
 "test": "vitest" //pnpm test
```

La première étape est de définir un fichier de config `:vitest.config.ts`

```tsx
//vitest.config.ts
import {defineConfig} from 'vitest/config'
import react from '@vitejs/plugin-react'
import tsconfigPaths from 'vite-tsconfig-paths'

export default defineConfig({
  plugins: [react(), tsconfigPaths()],
  test: {
    environment: 'jsdom',
    setupFiles: ['./src/__tests__/setup-test.ts'],
    include: ['**/*.test.{ts,tsx}'],
    alias: {
      '@/*': './src/*',
    },
    globals: true,
    fileParallelism: false,
  },
})
```

Voici les points clés de cette configuration :

1. **Plugins :**
   - `react()` : Support `React` avec `JSX` et `Fast Refresh`.
   - `tsconfigPaths()` : Résolution automatique des alias définis dans `tsconfig.json`.
2. **Tests :**
   - **Environnement `jsdom`** : Simule un `DOM` pour tester `React` ou tout ce qui interagit avec le navigateur.
   - **`setupFiles`** : Charge un fichier pour configurer des globales ou mocker des modules avant les tests.
   - **Fichiers inclus :** Tous les fichiers `.test.ts/tsx` sont détectés automatiquement.
3. **Extras :**
   - **Alias `@/`** : Facilite les imports depuis `src/`.
   - **Globales activées :** Pas besoin d’importer manuellement `describe`, `it` ou `expect`.

C’est une config simple, puissante et optimisée pour démarrer rapidement avec des tests modernes.

Le setup contenant `import '@testing-library/jest-dom/vitest'` sert à enrichir les capacités de test en ajoutant des **`matchers` personnalisés** pour tester plus facilement le `DOM` dans les projets `React`

```tsx
//setup-test.ts
import '@testing-library/jest-dom/vitest'

```

## Exercice

Dans un premier temps, vérifie que l’environnement `JS` et `JSDOM` s’exécutent correctement.

Pour cela, nous avons un jeu de test contenant deux tests :

```tsx
import {describe, it, expect} from 'vitest'

describe('Environment Test', () => {
  it('should run tests in js environment', () => {
    expect(1).toBe(1)
  })
  it('should run tests in jsdom environment', () => {
    // Crée un élément DOM fictif
    const element = document.createElement('div')
    element.id = 'test'
    element.textContent = 'Hello, World!'
    document.body.append(element)

    // Vérifie que l'élément est ajouté au DOM
    const foundElement = document.querySelector('#test')
    expect(foundElement).toBeInTheDocument()
    expect(foundElement?.textContent).toBe('Hello, World!')
  })
})

```

- **🐶** Edite `setup-test` pour faire en sorte que `@testing-library/jest-dom/vitest` soit utilisé.

Fichiers

- `src/__tests__/setup-test.ts`
- `vitest.config.ts`

## Aller plus loin

📑 Le lien vers la doc [https://vitest.dev/config/](https://vitest.dev/config/)

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent_
- **👨‍✈️ Hugo le chef de projet** : _Va t'aider sur les spécifications du projet_

## 🐜 Feedback

Remplir le formulaire [de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=8.Next%20Testing&entry.533578441=01%20Config%20Vitest+Next).
