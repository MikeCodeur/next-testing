# Test de la couche validation (Zod)

### ğŸ’¡ Lancer des tests validation

## ğŸ“ Tes notes

DÃ©taille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template).

## Comprendre

Dans cette section, tu vas tester les schÃ©mas de validation de ton application avec **`Zod`**. Les schÃ©mas de validation garantissent que les donnÃ©es envoyÃ©es Ã  ton service respectent les formats et contraintes attendus. Ces tests sont essentiels pour sÃ©curiser et fiabiliser la couche de validation de ton application.

Lâ€™objectif de cet exercice est de valider trois schÃ©mas principaux :

1. **`deleteProductServiceSchema`** : Validation des donnÃ©es pour la suppression dâ€™un produit.
2. **`createEditProductServiceSchema`** : Validation des donnÃ©es pour la crÃ©ation ou la modification dâ€™un produit.
3. **`updateProductServiceShema`** : Validation des donnÃ©es pour la mise Ã  jour dâ€™un produit.

Tu commenceras par tester les cas de base, comme des champs requis ou invalides, puis tu ajouteras des cas avancÃ©s dans les bonus.

Voici un exemple de schÃ©ma `Zod` simple pour valider un objet produit :

```jsx
import {z} from 'zod'

const productSchema = z.object({
  id: z.string().uuid(),
  title: z.string().min(2, 'Title must be at least 2 characters.'),
  description: z.string().min(2, 'Description must be at least 2 characters.'),
  price: z.number(),
})
```

Le schÃ©ma ci-dessus dÃ©finit les contraintes suivantes :

- `id` doit Ãªtre une chaÃ®ne au format `UUID`.
- `title` doit Ãªtre une chaÃ®ne avec au moins 2 caractÃ¨res.
- `description` doit Ã©galement avoir au moins 2 caractÃ¨res.
- `price` doit Ãªtre un nombre.

ğŸ“‘ Le lien vers la doc [Zod Documentation](https://zod.dev/).

## Exercice

Dans cet exercice, tu utiliseras **`Vitest`** pour Ã©crire des tests et vÃ©rifier que ces schÃ©mas se comportent correctement.

### Tests Ã  rÃ©aliser :

1. **`deleteProductServiceSchema`** :
   - Valide un objet avec un `id` UUID.
   - Rejette un objet si l'`id` est invalide (par exemple, un nombre Ã  la place dâ€™une chaÃ®ne).
2. **`createEditProductServiceSchema`** :
   - Valide un produit avec les champs requis (`category`, `price`, `title`, `description`).
   - Rejette un produit si :
     - Le titre est trop court (moins de 2 caractÃ¨res).
     - La description est trop courte (moins de 2 caractÃ¨res).
     - Des champs requis comme `category`, `title`, ou `description` sont manquants.

Fichiers

- `src/services/__tests__/product-validation.test.ts`

## Bonus

### 1. ğŸš€ Tester les champs optionnels dans `createEditProductServiceSchema`

Ajoute des tests pour valider que :

1. Les champs optionnels comme `id`, `createdAt`, et `quantity` sont acceptÃ©s.
2. Les champs numÃ©riques passÃ©s en chaÃ®ne (`"299.99"`) sont convertis en nombres.

Fichiers

- `src/services/__tests__/product-validation.test.ts`

### 2. ğŸš€ Valider la mise Ã  jour avec `updateProductServiceShema`

Ajoute des tests pour valider que :

1. Les donnÃ©es sont acceptÃ©es avec un `id` valide et des champs optionnels (`createdAt`, `quantity`).
2. Les donnÃ©es sont rejetÃ©es si :
   - L'`id` est manquant.
   - L'`id` est invalide (par exemple, un nombre au lieu d'une chaÃ®ne `UUID`).

Fichiers

- `src/services/__tests__/product-validation.test.ts`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [Zod Documentation](https://zod.dev/).

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand tu devras simplifier ton schÃ©ma ou ton code._
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Hugo tâ€™aidera sur les spÃ©cifications des schÃ©mas._

## ğŸœ Feedback

Remplis [le formulaire de feedback](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=8.Test%20Service%20Validation&entry.533578441=04%20test%20couche%20Validation).
