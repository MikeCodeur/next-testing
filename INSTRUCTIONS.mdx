# Test Service : Autorisation

### ğŸ’¡ Description longue de l'exercice

Dans cette section, tu vas Ã©crire des tests pour valider les fonctions dâ€™autorisation de ton application. Ces fonctions permettent de vÃ©rifier les permissions, les rÃ´les et la hiÃ©rarchie des rÃ´les utilisateurs.

Lâ€™objectif est de :

1. Garantir que seuls les utilisateurs autorisÃ©s peuvent effectuer certaines actions.
2. Tester les diffÃ©rents cas possibles, mÃªme ceux inattendus, pour garantir une application robuste.

Tu commenceras par tester deux fonctions principales : `canCreateProduct` et `canReadProduct`, avant dâ€™ajouter des tests pour les rÃ´les et la hiÃ©rarchie dans les bonus.

## ğŸ“ Tes notes

DÃ©taille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template).

## Comprendre

Voici un exemple de fonction pour gÃ©nÃ©rer un utilisateur de testâ€¯:

```jsx
const createTestUser = (role: RoleEnum): AuthUser => ({
  role,
  user: {
    id: faker.string.uuid(),
    email: faker.internet.email(),
    name: faker.person.firstName(),
    image: null,
  },
  session: {
    expires: new Date().toDateString(),
    user: {
      email: faker.internet.email(),
      name: faker.person.firstName(),
    },
  },
});

```

ğŸ“‘ Le lien vers la doc officielle [Vitest Documentation](https://vitest.dev/).

Les tests te permettront de vÃ©rifier que les fonctions retournent les bons rÃ©sultats en fonction des rÃ´les des utilisateurs.

---

## Exercice principal

Dans cet exercice, tu vas tester les deux fonctions suivantes :

1. **`canCreateProduct`** : VÃ©rifie si un utilisateur peut crÃ©er un produit.
2. **`canReadProduct`** : Retourne toujours `true`, peu importe lâ€™utilisateur.

Il est important de comprendre comment tester ces cas pour s'assurer que les autorisations de base sont bien respectÃ©es.

### Fichiers

- `exercise/service-authorization.test.js`

---

## Bonus

### 1. ğŸš€ Tester les rÃ´les (`hasRoleAdmin` et `hasRole`)

Ajoute des tests pour valider les rÃ´les des utilisateursâ€¯:

1. **`hasRoleAdmin`** :
   - VÃ©rifie quâ€™un utilisateur admin est correctement identifiÃ©.
   - VÃ©rifie quâ€™un utilisateur non admin est refusÃ©.
2. **`hasRole`** :
   - VÃ©rifie quâ€™un utilisateur possÃ¨de un rÃ´le donnÃ©.
   - VÃ©rifie que la fonction retourne `false` si le rÃ´le ne correspond pas.

### Fichiers

- `bonus-1/service-authorization.test.js`

---

### 2. ğŸš€ VÃ©rifier la hiÃ©rarchie des rÃ´les (`checkRoleHierarchy`)

Ajoute des tests pour valider la hiÃ©rarchie des rÃ´lesâ€¯:

1. Un utilisateur avec un rÃ´le supÃ©rieur peut accÃ©der aux fonctionnalitÃ©s des rÃ´les infÃ©rieurs.
2. Un utilisateur avec un rÃ´le Ã©gal peut accÃ©der Ã  ses propres fonctionnalitÃ©s.
3. Un utilisateur avec un rÃ´le infÃ©rieur ne peut pas accÃ©der aux fonctionnalitÃ©s des rÃ´les supÃ©rieurs.

### Fichiers

- `bonus-2/service-authorization.test.js`

---

## Aller plus loin

ğŸ“‘ Le lien vers la documentationâ€¯:

- [Vitest](https://vitest.dev/)
- [Faker.js](https://fakerjs.dev/)

---

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  simplifier ou Ã  supprimer est prÃ©sent._
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Hugo tâ€™aidera sur les spÃ©cifications des tests._

---

## ğŸœ Feedback

Remplis le formulaire de [FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20Mastery&entry.1430994900=8.Next%20Testing&entry.533578441=03%20Test-authorization).
