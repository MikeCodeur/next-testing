# Test de la couche service (avec DAO mocké)

### 💡 Description longue de l'exercice

Dans cette section, tu vas tester les fonctions de service utilisées pour gérer les produits. Ces services interagissent avec la couche DAO (Data Access Object) pour effectuer les opérations sur les données. L'objectif est de s'assurer que chaque service fonctionne correctement et respecte les règles d'autorisation définies.

Tu utiliseras **Vitest** pour écrire et exécuter les tests, et tu apprendras à :

1. Mocker la couche DAO pour simuler des appels à la base de données.
2. Tester les autorisations en fonction des rôles utilisateur.
3. Valider les comportements pour différents scénarios (succès, échec, permissions).

---

## 📝 Tes notes

Détaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template).

---

## Comprendre

Voici un exemple de mock simple en Vitest :

```jsx
javascript
CopierModifier
vi.mock('@/db/repositories/product-repository', () => ({
  getProductsDao: vi.fn(),
}))

vi.mocked(productRepository).getProductsDao.mockResolvedValue([
  {
    id: '12345',
    title: 'Produit test',
  },
])
```

📑 Le lien vers la doc officielle de Vitest Mocking.

---

## Exercice

Dans cet exercice, tu dois tester les services suivants :

### 1. **`getProductsService`** (Lecture des produits)

- Mocke le DAO `getProductsDao` pour simuler une liste de produits.
- Vérifie que tout le monde (tous les rôles) peut appeler ce service.

### 2. **`getCategoriesService`** (Lecture des catégories)

- Mocke le DAO `getCategoriesDao` pour simuler une liste de catégories.
- Vérifie que tout le monde (tous les rôles) peut appeler ce service.

**Fichiers à utiliser :**

- `exercise/services/product-service-mocked.exercise.js`

---

## Bonus

### 1. 🚀 **`createProductService`**

Ajoute des tests pour la création de produit :

- Vérifie qu'un utilisateur avec le rôle `USER` ne peut pas créer de produit.
- Vérifie qu'un utilisateur avec le rôle `ADMIN` peut créer un produit.
- Mocke le DAO `createProductDao` pour valider son appel avec les bons arguments.

**Fichiers à utiliser :**

- `exercise/services/product-service-mocked.bonus-1.js`

---

### 2. 🚀 **`updateProductService`**

Ajoute des tests pour la mise à jour de produit :

- Vérifie qu'un utilisateur avec le rôle `USER` ne peut pas mettre à jour un produit.
- Vérifie qu'un utilisateur avec le rôle `ADMIN` peut mettre à jour un produit.
- Mocke le DAO `updateProductDao` pour valider son appel avec les bons arguments.

**Fichiers à utiliser :**

- `exercise/services/product-service-mocked.bonus-2.js`

---

## Aller plus loin

📑 Le lien vers la doc pour Mocker les modules en JavaScript.

---

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia la Roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent._
- **👨‍✈️ Hugo le chef de projet** : _Va t’aider sur les spécifications du projet._

---

## 🐜 Feedback

Remplis le [formulaire de FeedBack](https://go.mikecodeur.com/cours-react-avis).
